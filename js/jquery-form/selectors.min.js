(function(d){function c(m,g,f){g=f||g;var j=g?"<option value=''>"+g+"</option>":"<option value=''>\u8bf7\u9009\u62e9</option>";if(!m){return j}var l=j;for(i in m){if(typeof m[i]==="string"||typeof m[i]==="number"){l+="<option value='"+m[i]+"'>"+i+"</option>"}else{var e=i,k=i,h=i.split("_");if(h.length===2){e=h[0];k=h[1]}l+="<option value='"+k+"'>"+e+"</option>"}}return l}function b(f,g){var o={};g=g||new Date();for(var n=g.getFullYear();n>=f.getFullYear();n--){var l={},j=(n==f.getFullYear())?f.getMonth():0,h=(n==g.getFullYear())?g.getMonth():11;for(var k=j;k<=h;k++){var m=(n==f.getFullYear()&&k==f.getMonth())?f.getDate():1,e=(n==g.getFullYear()&&k==g.getMonth())?g.getDate():31;l[(k+1)+"\u6708_"+n+"-"+(k+1)]=p(n,k,m,e)}o[n+"\u5e74"]=l}function p(x,w,q,u){var r=0,y={},v=u?parseInt(u):9999,s=q||1;switch(w){case 0:case 2:case 4:case 6:case 7:case 9:case 11:r=31;break;case 3:case 5:case 8:case 10:r=30;break;case 1:r=(x%4==0&&x%100!=0||x%400==0)?29:28;break;default:r=0}r=r>v?v:r;for(var t=q;t<=r;t++){y[t+"\u65e5"]=x+"-"+(w+1)+"-"+t}return y}return o}var a={options:{o:null,selectors:null,selectorModel:{},next:d("<span></span>"),withDefault:"\u8bf7\u9009\u62e9",hiddenEmpty:true,brancheValue:false,devide:"_",chainSpliter:"$",chainFirst:"$$"},_create:function(r,k){var p=this,j=d.extend(p.options,r),f=j.withDefault,n=j.chainSpliter,e=j.hiddenEmpty,l=j.next,m=j.brancheValue,g=j.o,h={},q={};if(!g){return}this._reverseMap(g,"",h,q);this._sumSelectors(h);k.each(function(){var t=0;d(this).hide().after((l&&(l instanceof d)&&l.length===1)?j.next.clone().removeAttr("id"):d("<span></span>"));var u=d(this).next().html("");while(t<p.options.selectors.length){var o=d("<select>"+c(null,f,p.options.selectors[t]["defaultOption"])+"</select>").attr(p.options.selectors[t]);u.append(o);t++}var s=d(this),v=d(this).val();var w=u.children().first();w.html(c(g,f,w.attr("defaultOption")));d(this).data("selectData",{o:g,valueMap:h,optionMap:q,withDefault:f,chainSpliter:n,hiddenEmpty:e});u.on("change","select",function(){var x=d(this).next();d(this).nextAll().each(function(){d(this).html(c(null,f,d(this).attr("defaultOption")))});if(p.options.hiddenEmpty){d(this).nextAll().hide();if(d(this).val()&&q[d(this).val()]){d(this).next().show()}}if(x.length){x.html(c(q[d(this).val()],f,x.attr("defaultOption")))}s.val(d(this).val()).attr("value",d(this).val()).change();if(!m&&q[d(this).val()]){s.val("").attr("value","").change()}});d(this).selectValue(d(this).val())})},_sumSelectors:function(l){var h=this.options,k=h.selectors,g=h.selectorModel;if(k&&k.length){}else{var f=0;for(key in l){var e=l[key].split(h.chainSpliter).length;if(f<e){f=e}}h.selectors=new Array();for(var j=0;j<f-2;j++){h.selectors[j]=g}}},_reverseMap:function(k,j,l,h){var j=j||"",l=l||{},h=h||{},g=j.split(this.options.chainSpliter).pop();if(k instanceof Array){k=h[g]=this._arrayToJson(h[g],this.options.devide)}for(i in k){if(typeof k[i]==="string"||typeof k[i]==="number"){l[k[i]]=j+this.options.chainSpliter+k[i]+this.options.chainSpliter+i;l[this.options.chainFirst]=l[this.options.chainFirst]||l[k[i]]}else{var f=i;var e=i.split(this.options.devide);if(e.length===2){l[e[1]]=j+this.options.chainSpliter+e[1]+this.options.chainSpliter+e[0];f=e[1];h[f]=k[i]}else{h[i]=k[i]}this._reverseMap(k[i],j+this.options.chainSpliter+f,l,h)}}},_arrayToJson:function(e,j){var h={};for(var g in e){if(typeof e[g]==="string"){var f=e[g].split(j);f.push(f[0]);h[f[0]]=f[1]}}return h}};d.fn.extend({selectors:function(e){if(e.beginDate){e.o=e.o||b(e.beginDate,e.endDate)}a._create(e,this);return this},selectValue:function(e){if(e===undefined){return d(this).val()}else{d(this).val(e).attr("value",e);return d(this).each(function(){var j=d(this);var h=j.data("selectData");if(!h){return}var l=h.o,n=h.valueMap,g=h.optionMap;withDefault=h.withDefault,hiddenEmpty=h.hiddenEmpty,chainSpliter=h.chainSpliter;var k=j.next().children().first();var m="";if(e&&n[e]){m=n[e]}else{k.children().removeAttr("selected").first().attr("selected",true).select()}var f=m.split(chainSpliter);k.children("option[value="+(f[1]||"")+"]").attr("selected",true);j.next().children().each(function(o){next=d(this).next().show();if(next.length){next.html(c(g[f[o+1]],withDefault,next.attr("defaultOption")));if(hiddenEmpty){if(next.children().length===1){next.hide()}}try{next.children("option[value="+(f[o+2]||"")+"]").attr("selected",true)}catch(p){}}})})}}})})(jQuery);
