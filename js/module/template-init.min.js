define(function(b,a,c){var e=jQuery,d={append:false,sourceMethod:"get",sourceData:function(){return{}},page:{size:"page.size",to:"page.pn"},nonResult:'<div class="no-content" style="padding-top: 150px;"><span class="nocon-bid"></span><span class="nocon-detail">\u6682\u65e0\u5185\u5bb9\uff01</span></div>'};Handlebars.registerHelper("division",function(g,f){return g/f});return{__simple__:function(g,i){if(typeof g.begin==="function"){g.begin.call(this,g,i)}var m=e(g.tmpl).html();var n=e(g.target);var j=Handlebars.compile(m)(g.source),h=e("<div>"+j+"</div>");var l=h.children(".currentPage").hide().html(),k=Math.ceil(h.children(".totalPage").hide().html());e(g.pagination).hide();if(k===0){h.html(g.nonResult)}if(g.prepend){n.prepend(h.html())}else{g.append?n.append(h.html()):n.html(h.html())}var f=null;if(g.pagination){b(["form-style"],function(){if(k!="0"){e(g.pagination).show()}g.url=location.href.replace(new RegExp("([?])?[&]?"+g.page.to+"=\\w*&?"),"$1");f=e(g.pagination).toPager({currentPage:Math.floor(l)||1,totalPage:k|0},!i);if(typeof g.callback==="function"){g.callback.call(this,g,f,i)}else{if(f&&i){f.on("switch",function(o,p){location.href=g.url+(g.url.indexOf("?")>-1?("&"+g.page.to+"="+p.toPage):("?"+g.page.to+"="+p.toPage))})}}})}},__ajax__:function(l,k){var h=e(l.tmpl).html();var j=e(l.target);var i=(l.sourceMethod=="post")?"post":"get";var f=this;if(typeof l.before==="function"){l.before.call(f,l,k)}else{if(!l.prepend&&!l.append){j.html("");j.append(e('<div class="list-wait">\u7b49\u5f85\u4e2d...</div>'))}}var g={};if("get"===i){g.t=new Date().getTime()}if(l.pagination){g[l.page.to]=l.toPage||"";g[l.page.size]=10}e[i](l.sourceUrl,e.extend(g,l.sourceData()),function(q){if(q.code&&q.code!=200){j.html(l.nonResult);return}e(l.pagination).hide();l.source=q;if(typeof l.begin==="function"){l.begin.call(f,l,k)}var n=Handlebars.compile(h)(l.source),s=e("<div>"+n+"</div>");var o=s.children(".currentPage").hide().html(),m=Math.ceil(s.children(".totalPage").hide().html());if(m===0){s.html(l.nonResult)}s.remove(".list-wait");if(l.prepend){j.prepend(s.html())}else{l.append?j.append(s.html()):j.html(s.html())}var r=null;if(l.pagination){b(["form-style"],function(){r=e(l.pagination).toPager({currentPage:Math.floor(o)||1,totalPage:m|0,"switch":function(p,t){l.toPage=t.toPage;e(this).hide();f.__ajax__(l)}},!k);if(m!="0"){r.show()}})}if(typeof l.callback==="function"){l.callback.call(f,l,r,k)}},l.dataType||"json")},__init__:function(g,h){var f=e(g.tmpl),i=this;return f.each(function(){var j=e(this),k=e.extend(e.extend({},d),{sourceUrl:j.attr("data-url"),target:j.attr("data-target"),append:j.attr("data-append"),prepend:j.attr("data-prepend"),pagination:j.attr("data-pagination"),sourceMethod:j.attr("data-method"),dataType:j.attr("data-type")},g);if(k.sourceUrl){i.__ajax__(k,h)}else{i.__simple__(k,h)}})},init:function(f){return this.__init__(f,true)},refresh:function(f){return this.__init__(f,false)}}});
